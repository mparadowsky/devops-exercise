node() {
    def myImage
    stage("git") {
        git 'https://github.com/mparadowsky/devops-exercise'
    }
    stage("Building image") {
        myImage = docker.build("090660780783.dkr.ecr.eu-central-1.amazonaws.com/blog", "./blog")
    }
    stage("Pushing image to ECR") {
        myImage.push("latest")
    }
     stage("Clearing pods and deployments") {
        sh 'kubectl delete deployment/blog'
        sh 'kubectl delete deployment/database'
    }
    stage("Launching new deployments") {
        sh 'kubectl apply -f blog/kubernetes'
    }
    stage("Opening service") {
        sh 'minikube service blog-svc'
    }
}