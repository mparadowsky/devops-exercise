node() {
    def myImage
    def ver = sh (script: "git rev-parse --short HEAD | tr -d '\n'",returnStdout: true)
  
    stage("Cloning repository") {
        git 'https://github.com/mparadowsky/devops-exercise'
    }
    stage("Building image") {
        
        withEnv(['VERSION='+ver]) {
            sh 'cd blog && docker-compose build blog'
            sh 'cd blog && docker-compose push blog'
            
        }
    }
       stage("Launching app") {
        withEnv(['VERSION='+ver]) {
            sh 'kubectl apply -f blog/kubernetes'
            sh 'minikube service blog-svc'
        }
        
    }
}

