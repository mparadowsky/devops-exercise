node() {
    def myImage
    def version
  
    stage("Cloning repository") {
        git 'https://github.com/mparadowsky/devops-exercise'
    }
    stage("Building image") {
        ver = sh (script: "git rev-parse --short HEAD | tr -d '\n'",returnStdout: true)
        withEnv(['VERSION='+ver]) {
            sh 'cd blog && docker-compose build blog'
            sh 'cd blog && docker-compose push blog'
            
        }
    }
       stage("Launching app") {
         sh 'kubectl apply -f blog/kubernetes'
         sh 'minikube service blog-svc'
    }
}

